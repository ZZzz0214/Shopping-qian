# 商品新增页面清空按钮功能说明

## 功能概述

在商品新增页面（包括普通新增和复制新增）添加了"清空"按钮，用于快速清空所有表单数据，方便用户重新开始填写。

## 功能特点

### 1. 按钮位置
- 位于页面底部按钮区域
- 在"保存"按钮左侧
- 仅在新增页面显示（详情页面不显示）

### 2. 按钮样式
- 类型：warning（警告色）
- 状态：在表单提交过程中禁用
- 图标：无特殊图标

### 3. 确认机制
- 点击清空按钮会弹出确认对话框
- 提示用户"确定要清空所有表单数据吗？此操作不可恢复。"
- 用户可以选择"确定"或"取消"

## 功能实现

### 清空操作包括：

1. **重置表单数据**
   - 将所有字段重置为初始状态
   - 包括基本信息、价格库存、物流设置、商品详情、商品笔记、商品数据、其它设置等所有标签页

2. **清除验证状态**
   - 清除所有子组件的表单验证状态
   - 移除验证错误提示

3. **清除持久化数据**
   - 清除FormPersistence中保存的数据
   - 如果是复制新增，同时清除localStorage中的数据

4. **重置页面状态**
   - 重置复制数据处理标志
   - 将当前激活的标签页重置为"基础设置"

5. **用户反馈**
   - 显示"表单数据已清空"的成功提示

## 使用场景

### 1. 普通新增场景
- 用户填写了部分数据后想要重新开始
- 用户发现填写错误想要清空重填
- 用户想要基于空白表单重新设计商品

### 2. 复制新增场景
- 用户复制了商品数据但想要修改大部分内容
- 用户想要基于复制的商品创建全新的商品
- 用户发现复制的数据不符合需求想要重新开始

## 安全机制

### 1. 确认对话框
- 防止用户误操作
- 明确告知操作不可恢复
- 提供取消选项

### 2. 数据清理
- 彻底清除所有相关数据
- 包括本地存储和持久化数据
- 确保不会留下残留数据

### 3. 状态重置
- 重置所有相关状态标志
- 确保页面回到初始状态
- 避免状态混乱

## 技术实现

### 核心方法：clearForm()

```javascript
const clearForm = () => {
  ElMessageBox.confirm('确定要清空所有表单数据吗？此操作不可恢复。', '确认清空', {
    confirmButtonText: '确定',
    cancelButtonText: '取消',
    type: 'warning'
  }).then(() => {
    // 重置表单数据为初始状态
    formData.value = { /* 初始数据 */ }
    
    // 清除所有子组件的表单验证状态
    nextTick(() => {
      // 清除各子组件的验证状态
    })
    
    // 清除保存的数据
    if (name === 'ProductSpuAdd') {
      formPersistence.clearFormData(pageKey)
      if (query.copyDataId) {
        localStorage.removeItem(localStorageKey)
      }
    }
    
    // 重置状态
    copyDataProcessed.value = false
    activeName.value = 'info'
    
    message.success('表单数据已清空')
  }).catch(() => {
    // 用户取消清空操作
  })
}
```

### 按钮模板

```html
<el-button v-if="!isDetail" type="warning" @click="clearForm" :disabled="formLoading">
  清空
</el-button>
```

## 注意事项

### 1. 操作不可恢复
- 清空操作会永久删除当前页面的所有数据
- 建议用户在清空前确认数据是否需要保存

### 2. 影响范围
- 清空操作会影响所有标签页的数据
- 包括已填写但未保存的所有内容

### 3. 数据同步
- 清空操作会同步清除所有相关的持久化数据
- 确保数据的一致性

### 4. 用户体验
- 提供明确的确认提示
- 操作完成后给出成功反馈
- 支持取消操作

## 测试建议

### 测试场景1：普通新增清空
1. 进入商品新增页面
2. 填写部分数据
3. 点击清空按钮
4. 确认清空操作
5. 验证所有数据已清空

### 测试场景2：复制新增清空
1. 复制商品进入新增页面
2. 修改部分数据
3. 点击清空按钮
4. 确认清空操作
5. 验证所有数据已清空

### 测试场景3：取消清空
1. 填写部分数据
2. 点击清空按钮
3. 点击取消
4. 验证数据未丢失

### 测试场景4：表单验证状态
1. 填写数据并触发验证错误
2. 点击清空按钮
3. 确认清空操作
4. 验证验证状态已清除

## 总结

清空按钮为用户提供了便捷的数据重置功能，特别适用于需要重新开始填写表单的场景。通过确认对话框和安全机制，确保用户不会误操作，同时提供良好的用户体验。 